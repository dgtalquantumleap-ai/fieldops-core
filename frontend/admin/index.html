<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stilt Heights - Professional Operations Dashboard</title>
    <link rel="manifest" href="/admin/manifest.json">
    <link rel="stylesheet" href="/admin/css/styles.css">
    <link rel="stylesheet" href="/admin/css/mobile.css">
    <meta name="theme-color" content="#1e40af">
    <meta name="msapplication-TileColor" content="#1e40af">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Operations">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè†</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè†</text></svg>">
</head>
<body>
    <!-- Mobile Header -->
    <header class="mobile-header">
        <div class="header-left">
            <button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>
            <h1>Stilt Heights Operations</h1>
        </div>
        <div class="header-right">
            <span class="business-name">Stilt Heights</span>
            <button class="notification-btn" onclick="showNotifications()">üîî</button>
        </div>
    </header>

    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <span class="logo-icon">üè†</span>
                <div>
                    <h2>Stilt Heights</h2>
                    <p class="business-subtitle">Professional Operations</p>
                </div>
            </div>
            <div class="powered-by">
                <span class="powered-text">Powered by FieldOps Core</span>
                <span class="creator-text">by Ebenova Solutions</span>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <a href="#dashboard" class="nav-item active" onclick="showSection('dashboard')">
                <span class="nav-icon">üìä</span>
                <span>Dashboard</span>
            </a>
            <a href="#customers" class="nav-item" onclick="showSection('customers')">
                <span class="nav-icon">üë•</span>
                <span>Customers</span>
            </a>
            <a href="#jobs" class="nav-item" onclick="showSection('jobs')">
                <span class="nav-icon">üìã</span>
                <span>Jobs</span>
            </a>
            <a href="#staff" class="nav-item" onclick="showSection('staff')">
                <span class="nav-icon">üë§</span>
                <span>Staff</span>
            </a>
            <a href="#invoices" class="nav-item" onclick="showSection('invoices')">
                <span class="nav-icon">üí∞</span>
                <span>Invoices</span>
            </a>
            <a href="#automations" class="nav-item" onclick="showSection('automations')">
                <span class="nav-icon">ü§ñ</span>
                <span>Automations</span>
            </a>
            <a href="#audit" class="nav-item" onclick="showSection('audit')">
                <span class="nav-icon">üîç</span>
                <span>Audit</span>
            </a>
            <a href="#settings" class="nav-item" onclick="showSection('settings')">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span>Settings</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="user-profile">
                <div class="user-avatar">üë§</div>
                <div class="user-info">
                    <div class="user-name">Admin User</div>
                    <div class="user-role">Administrator</div>
                </div>
            </div>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboard" class="content-section active">
            <div class="section-header">
                <h2>Stilt Heights Operations Dashboard</h2>
                <div class="header-actions">
                    <button class="btn-primary" onclick="showCreateJobModal()">+ Create Job</button>
                    <button class="btn-secondary" onclick="refreshDashboard()">üîÑ Refresh</button>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="stats-grid">
                <div class="stat-card today-jobs">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-content">
                        <h3 id="today-jobs-count">0</h3>
                        <p>Today's Jobs</p>
                        <span class="stat-trend" id="today-jobs-trend">+0%</span>
                    </div>
                </div>
                <div class="stat-card pending-jobs">
                    <div class="stat-icon">‚è∞</div>
                    <div class="stat-content">
                        <h3 id="pending-jobs-count">0</h3>
                        <p>Pending Jobs</p>
                        <span class="stat-trend" id="pending-jobs-trend">+0%</span>
                    </div>
                </div>
                <div class="stat-card completed-jobs">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-content">
                        <h3 id="completed-jobs-count">0</h3>
                        <p>Completed</p>
                        <span class="stat-trend" id="completed-jobs-trend">+0%</span>
                    </div>
                </div>
                <div class="stat-card revenue">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-content">
                        <h3 id="revenue-count">$0</h3>
                        <p>Total Revenue</p>
                        <span class="stat-trend" id="revenue-trend">+0%</span>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>Revenue Trend (7 Days)</h3>
                    <div class="chart-container">
                        <canvas id="revenue-chart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Job Status Distribution</h3>
                    <div class="chart-container">
                        <canvas id="status-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="activity-section">
                <h3>Recent Activity</h3>
                <div class="activity-feed" id="activity-feed">
                    <div class="activity-item loading">Loading recent activity...</div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <button class="action-card" onclick="openSchedulingPlugin()">
                    <span class="action-icon">üìÖ</span>
                    <span>Scheduling Plugin</span>
                </button>
                <button class="action-card" onclick="showSection('customers')">
                    <span class="action-icon">üë•</span>
                    <span>Add Customer</span>
                </button>
                <button class="action-card" onclick="showSection('invoices')">
                    <span class="action-icon">üí∞</span>
                    <span>Create Invoice</span>
                </button>
                <button class="action-card" onclick="showSection('staff')">
                    <span class="action-icon">üë§</span>
                    <span>Assign Staff</span>
                </button>
            </div>
        </section>

        <!-- Customers Section -->
        <section id="customers" class="content-section">
            <div class="section-header">
                <h2>Customer Management</h2>
                <div class="header-actions">
                    <button class="btn-primary" onclick="showAddCustomerModal()">+ Add Customer</button>
                    <input type="search" placeholder="Search customers..." class="search-input" id="customer-search">
                </div>
            </div>
            <div class="customers-grid" id="customers-list">
                <div class="loading">Loading customers...</div>
            </div>
        </section>

        <!-- Jobs Section -->
        <section id="jobs" class="content-section">
            <div class="section-header">
                <h2>Job Management</h2>
                <div class="header-actions">
                    <button class="btn-primary" onclick="showCreateJobModal()">+ Create Job</button>
                    <select class="filter-select" id="job-filter" title="Filter jobs by status">
                        <option value="all">All Jobs</option>
                        <option value="scheduled">Scheduled</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
            </div>
            <div class="jobs-list" id="jobs-list">
                <div class="loading">Loading jobs...</div>
            </div>
        </section>

        <!-- Staff Management Section (Enhanced) -->
        <section id="staff" class="content-section">
            <div class="section-header">
                <h2>Staff Management</h2>
                <div class="header-actions">
                    <select class="filter-select" id="staff-filter" title="Filter staff by status" onchange="loadStaffManagement()">
                        <option value="all">All Staff</option>
                        <option value="active">Active</option>
                        <option value="suspended">Suspended</option>
                        <option value="inactive">Terminated</option>
                    </select>
                    <button class="btn-primary" onclick="showAddStaffModal()">+ Onboard Staff</button>
                </div>
            </div>
            
            <!-- Staff Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-content">
                        <h3 id="total-staff-count">0</h3>
                        <p>Total Staff</p>
                    </div>
                </div>
                <div class="stat-card active-staff">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-content">
                        <h3 id="active-staff-count">0</h3>
                        <p>Active</p>
                    </div>
                </div>
                <div class="stat-card suspended-staff">
                    <div class="stat-icon">‚è∏Ô∏è</div>
                    <div class="stat-content">
                        <h3 id="suspended-staff-count">0</h3>
                        <p>Suspended</p>
                    </div>
                </div>
                <div class="stat-card terminated-staff">
                    <div class="stat-icon">‚ùå</div>
                    <div class="stat-content">
                        <h3 id="terminated-staff-count">0</h3>
                        <p>Terminated</p>
                    </div>
                </div>
            </div>
            
            <div class="staff-grid" id="staff-management-list">
                <div class="loading">Loading staff...</div>
            </div>
        </section>

        <!-- Invoices Section -->
        <section id="invoices" class="content-section">
            <div class="section-header">
                <h2>Invoicing & Payments</h2>
                <div class="header-actions">
                    <button class="btn-primary" onclick="showCreateInvoiceModal()">+ Create Invoice</button>
                    <select class="filter-select" id="invoice-filter" title="Filter invoices by status">
                        <option value="all">All Invoices</option>
                        <option value="unpaid">Unpaid</option>
                        <option value="paid">Paid</option>
                    </select>
                </div>
            </div>
            <div class="invoices-list" id="invoices-list">
                <div class="loading">Loading invoices...</div>
            </div>
        </section>

        <!-- Automations Section -->
        <section id="automations" class="content-section">
            <div class="section-header">
                <h2>ü§ñ AI Automation Center</h2>
                <div class="header-actions">
                    <button class="btn-primary" onclick="showAddAutomationModal()">+ Add Automation</button>
                    <button class="btn-secondary" onclick="showAIDashboard()">ü§ñ AI Tools</button>
                </div>
            </div>
            
            <!-- AI Quick Actions -->
            <div class="ai-quick-actions">
                <h3>üöÄ Quick AI Actions</h3>
                <div class="quick-actions-grid">
                    <div class="action-card" onclick="showFollowUpModal()">
                        <div class="action-icon">üìß</div>
                        <h4>Send Follow-up</h4>
                        <p>AI-powered customer follow-up</p>
                    </div>
                    <div class="action-card" onclick="showStaffNotificationModal()">
                        <div class="action-icon">üë®‚Äçüíº</div>
                        <h4>Staff Notification</h4>
                        <p>AI job assignment alerts</p>
                    </div>
                    <div class="action-card" onclick="showCustomAIModal()">
                        <div class="action-icon">‚ú®</div>
                        <h4>Custom Message</h4>
                        <p>Generate custom AI message</p>
                    </div>
                    <div class="action-card" onclick="showAITemplates()">
                        <div class="action-icon">üìã</div>
                        <h4>AI Templates</h4>
                        <p>View available templates</p>
                    </div>
                </div>
            </div>

            <!-- AI Status -->
            <div class="ai-status-bar">
                <div class="status-item">
                    <span class="status-indicator active"></span>
                    <span>AI Service: Active</span>
                </div>
                <div class="status-item">
                    <span class="status-indicator active"></span>
                    <span>Hugging Face: Connected</span>
                </div>
                <div class="status-item">
                    <span class="status-indicator active"></span>
                    <span>5 Templates Available</span>
                </div>
            </div>
            
            <!-- Traditional Automations -->
            <div class="traditional-automations">
                <h3>üìã Traditional Automations</h3>
                <div class="automations-list" id="automations-list">
                    <div class="loading">Loading automations...</div>
                </div>
            </div>
        </section>

        <!-- Audit Section -->
        <section id="audit" class="content-section">
            <div class="section-header">
                <h2>üîç System Audit & Monitoring</h2>
                <div class="header-actions">
                    <button class="btn-secondary" onclick="loadAuditLogs()">View Audit Logs</button>
                    <button class="btn-secondary" onclick="loadSystemHealth()">System Health</button>
                </div>
            </div>
            
            <div class="audit-dashboard" id="audit-dashboard" hidden>
                <div class="audit-filters">
                    <div class="filter-group">
                        <label for="audit-action">Action:</label>
                        <select id="audit-action" onchange="loadAuditLogs()">
                            <option value="">All Actions</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="audit-entity">Entity:</label>
                        <select id="audit-entity" onchange="loadAuditLogs()">
                            <option value="">All Entities</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="audit-date-from">From:</label>
                        <input type="date" id="audit-date-from" onchange="loadAuditLogs()">
                    </div>
                    <div class="filter-group">
                        <label for="audit-date-to">To:</label>
                        <input type="date" id="audit-date-to" onchange="loadAuditLogs()">
                    </div>
                </div>
                
                <div class="audit-content">
                    <div id="audit-logs-container">
                        <div class="loading">Loading audit logs...</div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Settings Section -->
        <section id="settings" class="content-section">
            <div class="section-header">
                <h2>Settings & Customization</h2>
            </div>
            <div class="settings-grid">
                <div class="setting-card">
                    <h3>Business Information</h3>
                    <div class="setting-content">
                        <div class="form-group">
                            <label for="business-name">Business Name</label>
                            <input type="text" value="Stilt Heights" id="business-name" title="Business name" placeholder="Enter business name">
                        </div>
                        <div class="form-group">
                            <label for="business-phone">Phone</label>
                            <input type="tel" value="8259946606" id="business-phone" title="Business phone" placeholder="Enter business phone">
                        </div>
                        <div class="form-group">
                            <label for="business-email">Email</label>
                            <input type="email" value="dgtalquantumleap@gmail.com" id="business-email" title="Business email" placeholder="Enter business email">
                        </div>
                        <button class="btn-primary" onclick="saveBusinessSettings()">Save Changes</button>
                    </div>
                </div>

                <div class="setting-card">
                    <h3>Service Types</h3>
                    <div class="setting-content">
                        <div class="service-list" id="service-list">
                            <div class="service-item">
                                <span>Regular Housekeeping</span>
                                <button class="btn-small" onclick="editService(this)">Edit</button>
                            </div>
                            <div class="service-item">
                                <span>One-time Cleaning</span>
                                <button class="btn-small" onclick="editService(this)">Edit</button>
                            </div>
                            <div class="service-item">
                                <span>Dish Washing</span>
                                <button class="btn-small" onclick="editService(this)">Edit</button>
                            </div>
                        </div>
                        <button class="btn-secondary" onclick="addNewService()">+ Add Service</button>
                    </div>
                </div>

                <div class="setting-card">
                    <h3>Label Customization</h3>
                    <div class="setting-content">
                        <div class="form-group">
                            <label for="jobs-label">Jobs Label</label>
                            <input type="text" value="Jobs" id="jobs-label" aria-label="Jobs label customization" title="Jobs label">
                        </div>
                        <div class="form-group">
                            <label for="customers-label">Customers Label</label>
                            <input type="text" value="Customers" id="customers-label" aria-label="Customers label customization" title="Customers label">
                        </div>
                        <div class="form-group">
                            <label for="staff-label">Staff Label</label>
                            <input type="text" value="Staff" id="staff-label" aria-label="Staff label customization" title="Staff label">
                        </div>
                        <button class="btn-primary" onclick="saveLabelSettings()">Apply Changes</button>
                    </div>
                </div>

                <div class="setting-card">
                    <h3>Module Settings</h3>
                    <div class="setting-content">
                        <div class="module-toggle">
                            <label class="toggle-switch">
                                <input type="checkbox" checked aria-label="Enable Customer Management module">
                                <span class="slider"></span>
                            </label>
                            <span>Customer Management</span>
                        </div>
                        <div class="module-toggle">
                            <label class="toggle-switch">
                                <input type="checkbox" checked aria-label="Enable Job Management module">
                                <span class="slider"></span>
                            </label>
                            <span>Job Management</span>
                        </div>
                        <div class="module-toggle">
                            <label class="toggle-switch">
                                <input type="checkbox" checked aria-label="Enable Staff Management module">
                                <span class="slider"></span>
                            </label>
                            <span>Staff Management</span>
                        </div>
                        <div class="module-toggle">
                            <label class="toggle-switch">
                                <input type="checkbox" checked aria-label="Enable Invoicing module">
                                <span class="slider"></span>
                            </label>
                            <span>Invoicing</span>
                        </div>
                        <div class="module-toggle">
                            <label class="toggle-switch">
                                <input type="checkbox" checked aria-label="Enable Automations module">
                                <span class="slider"></span>
                            </label>
                            <span>Automations</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer Attribution -->
    <footer class="footer-attribution">
        <div class="footer-content">
            <p class="footer-text">
                Powered by <strong>FieldOps Core</strong> ‚Ä¢ Built by <a href="https://ebenova.com" target="_blank" rel="noopener" class="creator-link">Ebenova Solutions</a>
            </p>
            <p class="footer-subtitle">Professional Operations Management for Stilt Heights</p>
        </div>
    </footer>

    <!-- Modals -->
    <div id="modal-overlay" class="modal-overlay" onclick="closeAllModals()"></div>
    
    <!-- Create Job Modal -->
    <div id="create-job-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Job</h3>
                <button class="close-btn" onclick="closeModal('create-job-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="create-job-form">
                    <div class="form-group">
                        <label for="job-customer">Customer *</label>
                        <select id="job-customer" title="Select customer for job" required>
                            <option value="">Select Customer</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="job-service">Service Type *</label>
                        <select id="job-service" title="Select service type" required>
                            <option value="">Select Service</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="job-staff">Staff Member</label>
                        <select id="job-staff" title="Assign staff member">
                            <option value="">Unassigned</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="job-date">Date *</label>
                            <input type="date" id="job-date" title="Job date" required>
                        </div>
                        <div class="form-group">
                            <label for="job-time">Time *</label>
                            <input type="time" id="job-time" title="Job start time" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="job-location">Location *</label>
                        <input type="text" id="job-location" title="Job location" placeholder="Enter job address" required>
                    </div>
                    <div class="form-group">
                        <label for="job-notes">Notes</label>
                        <textarea id="job-notes" title="Additional job notes" rows="3" placeholder="Enter any additional notes"></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="closeModal('create-job-modal')">Cancel</button>
                        <button type="submit" class="btn-primary">Create Job</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div id="add-customer-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Customer</h3>
                <button class="close-btn" onclick="closeModal('add-customer-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="add-customer-form">
                    <div class="form-group">
                        <label for="customer-name">Name *</label>
                        <input type="text" id="customer-name" title="Customer full name" placeholder="Enter customer name" required>
                    </div>
                    <div class="form-group">
                        <label for="customer-phone">Phone *</label>
                        <input type="tel" id="customer-phone" title="Customer phone number" placeholder="Enter phone number" required>
                    </div>
                    <div class="form-group">
                        <label for="customer-email">Email</label>
                        <input type="email" id="customer-email" title="Customer email address" placeholder="Enter email address">
                    </div>
                    <div class="form-group">
                        <label for="customer-address">Address</label>
                        <input type="text" id="customer-address" title="Customer address" placeholder="Enter customer address">
                    </div>
                    <div class="form-group">
                        <label for="customer-notes">Notes</label>
                        <textarea id="customer-notes" title="Additional customer notes" rows="3" placeholder="Enter any additional notes"></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="closeModal('add-customer-modal')">Cancel</button>
                        <button type="submit" class="btn-primary">Add Customer</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Create Invoice Modal -->
    <div id="create-invoice-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Invoice</h3>
                <button class="close-btn" onclick="closeModal('create-invoice-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="create-invoice-form">
                    <div class="form-group">
                        <label for="invoice-customer">Customer *</label>
                        <select id="invoice-customer" required>
                            <option value="">Select Customer</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="invoice-job">Job (Optional)</label>
                        <select id="invoice-job">
                            <option value="">Select Job</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="invoice-number">Invoice Number *</label>
                        <input type="text" id="invoice-number" required placeholder="INV-001">
                    </div>
                    <div class="form-group">
                        <label for="invoice-amount">Amount ($) *</label>
                        <input type="number" id="invoice-amount" step="0.01" min="0" required placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="invoice-date">Issue Date *</label>
                        <input type="date" id="invoice-date" required>
                    </div>
                    <div class="form-group">
                        <label for="invoice-due-date">Due Date *</label>
                        <input type="date" id="invoice-due-date" required>
                    </div>
                    <div class="form-group">
                        <label for="invoice-notes">Notes</label>
                        <textarea id="invoice-notes" rows="3" placeholder="Enter any additional notes"></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="closeModal('create-invoice-modal')">Cancel</button>
                        <button type="button" class="btn-primary" onclick="saveInvoice()">Create Invoice</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Onboard Staff Modal -->
    <div id="onboard-staff-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Onboard New Staff Member</h3>
                <button class="close-btn" onclick="closeModal('onboard-staff-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="onboard-staff-form">
                    <div class="form-group">
                        <label for="staff-name">Full Name *</label>
                        <input type="text" id="staff-name" required>
                    </div>
                    <div class="form-group">
                        <label for="staff-email">Email Address *</label>
                        <input type="email" id="staff-email" required>
                    </div>
                    <div class="form-group">
                        <label for="staff-phone">Phone Number</label>
                        <input type="tel" id="staff-phone">
                    </div>
                    <div class="form-group">
                        <label for="staff-role">Role *</label>
                        <select id="staff-role" required>
                            <option value="Staff">Staff</option>
                            <option value="Manager">Manager</option>
                            <option value="Admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="staff-password">Temporary Password *</label>
                        <input type="password" id="staff-password" required>
                        <small>Staff member will be prompted to change this on first login</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="staff-active" checked>
                            Active Staff Member
                        </label>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="closeModal('onboard-staff-modal')">Cancel</button>
                        <button type="button" class="btn-primary" onclick="saveStaff()">Add Staff Member</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Staff Modal -->
    <div id="edit-staff-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Staff Member</h3>
                <button class="close-btn" onclick="closeModal('edit-staff-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="edit-staff-form">
                    <input type="hidden" id="edit-staff-id">
                    <div class="form-group">
                        <label for="edit-staff-name">Full Name *</label>
                        <input type="text" id="edit-staff-name" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-staff-email">Email Address *</label>
                        <input type="email" id="edit-staff-email" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-staff-phone">Phone Number</label>
                        <input type="tel" id="edit-staff-phone">
                    </div>
                    <div class="form-group">
                        <label for="edit-staff-role">Role *</label>
                        <select id="edit-staff-role" required>
                            <option value="Staff">Staff</option>
                            <option value="Manager">Manager</option>
                            <option value="Admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="edit-staff-active" checked>
                            Active Staff Member
                        </label>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="closeModal('edit-staff-modal')">Cancel</button>
                        <button type="button" class="btn-primary" onclick="updateStaff()">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Staff Details Modal -->
    <div id="staff-details-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Staff Details</h3>
                <button class="close-btn" onclick="closeModal('staff-details-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="staff-details-grid">
                    <div class="staff-info-section">
                        <h4>Basic Information</h4>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Name:</label>
                                <span id="detail-staff-name">-</span>
                            </div>
                            <div class="info-item">
                                <label>Email:</label>
                                <span id="detail-staff-email">-</span>
                            </div>
                            <div class="info-item">
                                <label>Phone:</label>
                                <span id="detail-staff-phone">-</span>
                            </div>
                            <div class="info-item">
                                <label>Role:</label>
                                <span id="detail-staff-role">-</span>
                            </div>
                            <div class="info-item">
                                <label>Status:</label>
                                <span id="detail-staff-status-badge" class="status-badge">-</span>
                            </div>
                            <div class="info-item">
                                <label>Created:</label>
                                <span id="detail-staff-created">-</span>
                            </div>
                            <div class="info-item">
                                <label>Updated:</label>
                                <span id="detail-staff-updated">-</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Notes:</label>
                            <p id="detail-staff-notes">-</p>
                        </div>
                    </div>
                    
                    <div class="staff-stats-section">
                        <h4>Job Statistics</h4>
                        <div class="stats-grid-small">
                            <div class="stat-card-small">
                                <h4 id="detail-total-jobs">0</h4>
                                <p>Total Jobs</p>
                            </div>
                            <div class="stat-card-small">
                                <h4 id="detail-completed-jobs">0</h4>
                                <p>Completed</p>
                            </div>
                            <div class="stat-card-small">
                                <h4 id="detail-scheduled-jobs">0</h4>
                                <p>Scheduled</p>
                            </div>
                            <div class="stat-card-small">
                                <h4 id="detail-in-progress-jobs">0</h4>
                                <p>In Progress</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="staff-jobs-section">
                    <h4>Recent Jobs</h4>
                    <div class="jobs-list" id="staff-jobs-list">
                        <div class="loading">Loading staff jobs...</div>
                    </div>
                </div>
                
                <div class="activity-section">
                    <h4>Activity Log</h4>
                    <div class="activity-log" id="staff-activity-log">
                        <div class="loading">Loading activity...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Invoice Details Modal -->
    <div id="invoice-details-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Invoice Details</h3>
                <button class="close-btn" onclick="closeModal('invoice-details-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="invoice-details-grid">
                    <div class="invoice-info-section">
                        <h4>Invoice Information</h4>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Invoice Number:</label>
                                <span id="detail-invoice-number">-</span>
                            </div>
                            <div class="info-item">
                                <label>Customer:</label>
                                <span id="detail-invoice-customer">-</span>
                            </div>
                            <div class="info-item">
                                <label>Amount:</label>
                                <span id="detail-invoice-amount">-</span>
                            </div>
                            <div class="info-item">
                                <label>Status:</label>
                                <span id="detail-invoice-status-badge" class="status-badge">-</span>
                            </div>
                            <div class="info-item">
                                <label>Issue Date:</label>
                                <span id="detail-invoice-issue-date">-</span>
                            </div>
                            <div class="info-item">
                                <label>Due Date:</label>
                                <span id="detail-invoice-due-date">-</span>
                            </div>
                            <div class="info-item">
                                <label>Paid Date:</label>
                                <span id="detail-invoice-paid-date">-</span>
                            </div>
                            <div class="info-item">
                                <label>Job:</label>
                                <span id="detail-invoice-job">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="invoice-notes-section">
                        <h4>Notes</h4>
                        <p id="detail-invoice-notes">-</p>
                    </div>
                </div>
                
                <div class="invoice-payments-section">
                    <h4>Payment History</h4>
                    <div class="payments-list" id="invoice-payments-list">
                        <div class="loading">Loading payment history...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Automation Modal -->
    <div id="add-automation-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Automation</h3>
                <button class="close-btn" onclick="closeModal('add-automation-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="add-automation-form">
                    <div class="form-group">
                        <label for="automation-trigger">Trigger Event *</label>
                        <select id="automation-trigger" aria-label="Select automation trigger event" required>
                            <option value="">Select Trigger</option>
                            <option value="Job Created">Job Created</option>
                            <option value="Job Completed">Job Completed</option>
                            <option value="Customer Booking">Customer Booking</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="automation-channel">Channel *</label>
                        <select id="automation-channel" aria-label="Select automation communication channel" required>
                            <option value="">Select Channel</option>
                            <option value="WhatsApp">WhatsApp</option>
                            <option value="SMS">SMS</option>
                            <option value="Email">Email</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="automation-message">Message Template *</label>
                        <textarea id="automation-message" rows="4" required placeholder="Enter your message template. Use {customer_name}, {job_date}, {service_name} as placeholders." aria-label="Automation message template"></textarea>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="automation-enabled" checked>
                            Enable this automation
                        </label>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="closeModal('add-automation-modal')">Cancel</button>
                        <button type="submit" class="btn-primary">Add Automation</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Automation Modal -->
    <div id="edit-automation-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Automation</h3>
                <button class="close-btn" onclick="closeModal('edit-automation-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="edit-automation-form">
                    <input type="hidden" id="edit-automation-id">
                    <div class="form-group">
                        <label for="edit-automation-trigger">Trigger Event *</label>
                        <select id="edit-automation-trigger" required>
                            <option value="">Select Trigger</option>
                            <option value="Job Created">Job Created</option>
                            <option value="Job Completed">Job Completed</option>
                            <option value="Customer Booking">Customer Booking</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-automation-channel">Channel *</label>
                        <select id="edit-automation-channel" required>
                            <option value="">Select Channel</option>
                            <option value="WhatsApp">WhatsApp</option>
                            <option value="SMS">SMS</option>
                            <option value="Email">Email</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-automation-message">Message Template *</label>
                        <textarea id="edit-automation-message" rows="4" required placeholder="Enter your message template. Use {customer_name}, {job_date}, {service_name} as placeholders."></textarea>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="edit-automation-enabled" checked>
                            Enable this automation
                        </label>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="closeModal('edit-automation-modal')">Cancel</button>
                        <button type="button" class="btn-primary" onclick="updateAutomation()">Update Automation</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Customer Details Modal -->
    <div id="customer-details-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Customer Details</h3>
                <button class="close-btn" onclick="closeModal('customer-details-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="customer-details-grid">
                    <div class="customer-info-section">
                        <h4>Basic Information</h4>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Name:</label>
                                <span id="detail-customer-name">-</span>
                            </div>
                            <div class="info-item">
                                <label>Phone:</label>
                                <span id="detail-customer-phone">-</span>
                            </div>
                            <div class="info-item">
                                <label>Email:</label>
                                <span id="detail-customer-email">-</span>
                            </div>
                            <div class="info-item">
                                <label>Address:</label>
                                <span id="detail-customer-address">-</span>
                            </div>
                            <div class="info-item">
                                <label>Notes:</label>
                                <p id="detail-customer-notes">-</p>
                            </div>
                            <div class="info-item">
                                <label>Customer Since:</label>
                                <span id="detail-customer-created">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="customer-jobs-section">
                        <h4>Recent Jobs</h4>
                        <div class="jobs-list" id="customer-jobs-list">
                            <div class="loading">Loading customer jobs...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Customer Modal -->
    <div id="edit-customer-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Customer</h3>
                <button class="close-btn" onclick="closeModal('edit-customer-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="edit-customer-form">
                    <input type="hidden" id="edit-customer-id">
                    <div class="form-group">
                        <label for="edit-customer-name">Name *</label>
                        <input type="text" id="edit-customer-name" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-customer-phone">Phone *</label>
                        <input type="tel" id="edit-customer-phone" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-customer-email">Email</label>
                        <input type="email" id="edit-customer-email">
                    </div>
                    <div class="form-group">
                        <label for="edit-customer-address">Address</label>
                        <input type="text" id="edit-customer-address">
                    </div>
                    <div class="form-group">
                        <label for="edit-customer-notes">Notes</label>
                        <textarea id="edit-customer-notes" rows="3"></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="closeModal('edit-customer-modal')">Cancel</button>
                        <button type="button" class="btn-primary" onclick="updateCustomer()">Update Customer</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Job Details Modal -->
    <div id="job-details-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Job Details</h3>
                <button class="close-btn" onclick="closeModal('job-details-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="job-details-grid">
                    <div class="job-info-section">
                        <h4>Job Information</h4>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Service:</label>
                                <span id="detail-job-service">-</span>
                            </div>
                            <div class="info-item">
                                <label>Customer:</label>
                                <span id="detail-job-customer">-</span>
                            </div>
                            <div class="info-item">
                                <label>Status:</label>
                                <span id="detail-job-status-badge" class="status-badge">-</span>
                            </div>
                            <div class="info-item">
                                <label>Date:</label>
                                <span id="detail-job-date">-</span>
                            </div>
                            <div class="info-item">
                                <label>Time:</label>
                                <span id="detail-job-time">-</span>
                            </div>
                            <div class="info-item">
                                <label>Location:</label>
                                <span id="detail-job-location">-</span>
                            </div>
                            <div class="info-item">
                                <label>Assigned Staff:</label>
                                <span id="detail-job-staff">-</span>
                            </div>
                            <div class="info-item">
                                <label>Created:</label>
                                <span id="detail-job-created">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="job-notes-section">
                        <h4>Notes</h4>
                        <p id="detail-job-notes">-</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Job Modal -->
    <div id="edit-job-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Job</h3>
                <button class="close-btn" onclick="closeModal('edit-job-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="edit-job-form">
                    <input type="hidden" id="edit-job-id">
                    <div class="form-group">
                        <label for="edit-job-status">Status *</label>
                        <select id="edit-job-status" required>
                            <option value="Scheduled">Scheduled</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Completed">Completed</option>
                            <option value="Cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-job-staff">Assign Staff</label>
                        <select id="edit-job-staff">
                            <option value="">Unassigned</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-job-notes">Notes</label>
                        <textarea id="edit-job-notes" rows="3"></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="closeModal('edit-job-modal')">Cancel</button>
                        <button type="button" class="btn-primary" onclick="updateJob()">Update Job</button>
                    </div>
                </form>
            </div>
    <!-- Service Layer Scripts (must load in order) -->
    <script src="/admin/js/services/logger.js"></script>
    
    <!-- Error Boundary (load after logger) -->
    <script src="/admin/js/services/error-boundary.js"></script>
    
    <script src="/admin/js/services/state.js"></script>
    <script src="/admin/js/services/utils.js"></script>
    <script src="/admin/js/services/ui.js"></script>
    <script src="/admin/js/services/api.js"></script>
    <script src="/admin/js/services/security.js"></script>
    <script src="/admin/js/services/performance.js"></script>
    <script src="/admin/js/services/forms.js"></script>
    
    <!-- Application -->
    <script src="/admin/js/app-refactored.js"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/admin/service-worker.js')
                .then(registration => {
                    console.log('‚úÖ Service Worker registered:', registration);
                    // Check for updates periodically
                    setInterval(() => registration.update(), 60000);
                })
                .catch(error => console.warn('Service Worker registration failed:', error));
        });
    }
    
    // Handle offline/online events
    window.addEventListener('offline', () => {
        console.log('‚ö†Ô∏è Connection lost - running in offline mode');
    });
    
    window.addEventListener('online', () => {
        console.log('‚úÖ Connection restored - syncing data');
    });
    </script>
</body>
</html>
